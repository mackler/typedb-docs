= Sending a schema query
:experimental:

This guide covers sending a query in a schema session and write transaction with TypeDB Studio, Console, or drivers.
Make sure the selected client is xref:guides::installation/overview.adoc[installed].

== Query execution workflow

To send a schema query, we need to open a `schema` session to an existing database, and then open a `write` transaction.
After successful execution of the query, the transaction must be committed to persist the changes made to the schema.
See the full process outline below.

. Establish network connection to TypeDB. See the xref:guides::connection/overview.adoc[] section.
. Open a `schema` session.
. Open a `write` transaction.
. Send a query for execution.
. Commit changes.
. Close the session.

For more information on how to create a new database, see the xref:guides::database/overview.adoc[] section.

== How to send a schema query

The following instructions are written with the assumption that a connection to TypeDB is already established.
For a connection guide, see the xref:guides::connection/overview.adoc[] section.

//#todo Consider removing TypeQL query and query method from examples
[tabs]
====
Studio::
+
--
. Select a database from a drop-down list in the top toolbar next to the database icon
image:home::studio-icons/database.png[].
. Switch to the `schema` session and `write` transaction types in the top toolbar.
. Copy-paste the following Define query to a new tab of the text editor panel:
+
.Define schema query
[,typeql]
----
define
credential sub attribute, value string;
full-name sub attribute, value string;
subject sub entity,
    abstract,
    owns credential;
user sub subject;
person sub user, owns full-name;
----
. Execute the query by clicking on the btn:[Run Query] (image:home::studio-icons/run.png[]) button.
. Commit the changes with the btn:[Commit transaction] (image:home::studio-icons/commit.png[]) button.
--

Console::
+
--
. Open a `schema` session and `write` transaction to a database, for example:
+
[,bash]
----
transaction db1 schema write
----
+
Where `db1` is the name of the database selected.
. Copy-paste the following Define query to the terminal and push btn:[Enter] *twice*:
+
.Define schema query
[,typeql]
----
define
credential sub attribute, value string;
full-name sub attribute, value string;
subject sub entity,
    abstract,
    owns credential;
user sub subject;
person sub user, owns full-name;
----
. Commit the changes made in the transaction:
+
[,bash]
----
commit
----
--

Rust::
+
--
.Define schema query
[,rust]
----
let query = "define
    credential sub attribute, value string;
    full-name sub attribute, value string;
    subject sub entity,
        abstract,
        owns credential;
    user sub subject;
    person sub user, owns full-name;";
let databases = DatabaseManager::new(driver);
let db = databases.get("db1")?;
let session = Session::new(db, SessionType::Schema)?;
let tx = session.transaction(TransactionType::Write)?;
tx.query().define(&query).resolve()?;
tx.commit().resolve()?;
----
--

Python::
+
--
.Define schema query
[,python]
----
query = "define" \
        "credential sub attribute, value string; " \
        "full-name sub attribute, value string; " \
        "subject sub entity," \
        "    abstract," \
        "    owns credential;" \
        "user sub subject;" \
        "person sub user, owns full-name;"
with driver.session("db1", SessionType.SCHEMA) as session:
    with session.transaction(TransactionType.WRITE) as transaction:
        transaction.query.define(query)
        transaction.commit()
----
--

Java::
+
--
.Define schema query
[,java]
----
String query = """
                define
                credential sub attribute, value string;
                full-name sub attribute, value string;
                subject sub entity,
                    abstract,
                    owns credential;
                user sub subject;
                person sub user, owns full-name;
                """;
try (TypeDBSession session = driver.session("db1", TypeDBSession.Type.SCHEMA)) {
    try (TypeDBTransaction writeTransaction = session.transaction(TypeDBTransaction.Type.WRITE)) {
        writeTransaction.query().define(query);
        writeTransaction.commit();
    }
}
----
--

Node.js::
+
--
.Define schema query
[,js]
----
const query = `define
                credential sub attribute, value string;
                full-name sub attribute, value string;
                subject sub entity,
                    abstract,
                    owns credential;
                user sub subject;
                person sub user, owns full-name;
                `;
try {
    session = await driver.session("db1", SessionType.SCHEMA);
    try {
        transaction = await session.transaction(TransactionType.WRITE);
        await transaction.query.define(query);
        await transaction.commit();
    }
    finally {
        if (transaction.isOpen()) {await transaction.close()};
    }
}
finally {
    await session?.close();
}
----
--

C++::
+
--
.Define schema query
[,js]
----
std::string query ="define\n"
                    "\n"
                    "id sub attribute, value long;\n"
                    "email sub attribute, value string;\n"
                    "full-name sub attribute, value string;\n"
                    "user sub entity,\n"
                    "    owns id @key,\n"
                    "    owns email,\n"
                    "    abstract;\n"
                    "person sub user, owns full-name;";
TypeDB::Options options;
{
    auto session = driver.session("db1", TypeDB::SessionType::SCHEMA, options);
    auto tx = session.transaction(TypeDB::TransactionType::WRITE, options);
    tx.query.define(query, options).get();
    tx.commit();
}
----
--
====

== Learn more

Send more queries: xref:guides::schema/define.adoc[Define] and xref:guides::schema/undefine.adoc[Undefine].

If you don't have your own schema ready yet, feel free to use the
https://github.com/vaticle/typedb-docs/blob/master/typedb-src/modules/ROOT/attachments/iam-schema.tql[IAM schema,window=_blank].
For more information about the IAM schema, see the xref:typedb::tutorials/iam-schema.adoc[] page.